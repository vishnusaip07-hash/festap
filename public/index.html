<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Fest Entry - Firebase Flow</title>
  <link rel="stylesheet" href="style.css">

  <style>
/* ----------------- AURORA FEST THEME ----------------- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: 'Poppins', sans-serif;
}

body {
  background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  color: #e0e0e0;
}

/* Containers */
.container, .login-container, .signup-container {
  background: rgba(15, 15, 25, 0.85);
  padding: 30px;
  border-radius: 18px;
  box-shadow: 0 0 25px rgba(0, 255, 200, 0.25), 0 0 40px rgba(255, 0, 128, 0.15);
  width: 360px;
  max-width: 90%;
  text-align: center;
  animation: fadeIn 0.6s ease-in-out;
  backdrop-filter: blur(6px);
}

h1, h2, h3 {
  margin-bottom: 20px;
  font-weight: 600;
  background: linear-gradient(90deg, #00ffcc, #ff3ec9);
  -webkit-background-clip: text;
  color: transparent;
  -webkit-text-fill-color: transparent;
}

input, select {
  padding: 8px 12px;
  font-size: 16px;
  margin: 8px 0;
  width: 100%;
  color: #000;
  background-color: #fff;
  border: 1px solid #ccc;
  border-radius: 5px;
}

button {
  width: 100%;
  padding: 12px;
  margin-top: 10px;
  background: linear-gradient(90deg, #00ffcc, #ff3ec9);
  color: #fff;
  border: none;
  border-radius: 12px;
  font-size: 16px;
  cursor: pointer;
  font-weight: 600;
}

button:hover {
  transform: translateY(-2px) scale(1.02);
  box-shadow: 0 0 15px rgba(0,255,200,0.4), 0 0 20px rgba(255,0,128,0.3);
}

.error { 
  color: #ff6b6b; 
  background: rgba(255,0,0,0.1);
  padding: 6px;
  border-radius: 8px;
  margin-top: 10px;
}

.list-box {
  max-height: 200px;
  overflow:auto;
  border:1px solid rgba(255,255,255,0.15);
  padding:10px;
  border-radius:12px;
  background: rgba(255,255,255,0.05);
  text-align:left;
  margin-bottom:10px;
  color: #ccc;
}

@keyframes fadeIn {
  0% { opacity:0; transform: translateY(-10px);}
  100% { opacity:1; transform: translateY(0);}
}

section { display: none; }
section.active { display: block; }
</style>

  
  <!-- Firebase SDKs -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { 
      getFirestore, collection, addDoc, getDocs, deleteDoc, doc 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // TODO: Replace with your Firebase config
    const firebaseConfig = {
  apiKey: "AIzaSyAlXr6m9jLqRb5EUVxDXd6ZXeViYJYRH9A",
  authDomain: "festapp-367a1.firebaseapp.com",
  projectId: "festapp-367a1",
  storageBucket: "festapp-367a1.firebasestorage.app",
  messagingSenderId: "965286702395",
  appId: "1:965286702395:web:21ccdbd85f2ba874439b1e",
  measurementId: "G-N7B0W2KNSX"
};

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // Expose Firebase to window
    window.firebaseServices = { 
      auth, createUserWithEmailAndPassword, signInWithEmailAndPassword, 
      db, collection, addDoc, getDocs, deleteDoc, doc 
    };
  </script>
</head>
<body>
  
  <!-- Login -->
  <section id="login" class="active">
    <div class="login-container">
      <h2>Login</h2>
      <form id="loginForm">
        <input type="email" id="loginEmail" placeholder="surname_rollno@nitc.ac.in" required>
        <input type="password" id="loginPassword" placeholder="Password" required>
        <button type="submit" class="main-btn login-btn">Login</button>
      </form>
      <p id="errorMsg" class="error"></p>
      <button class="back-btn" onclick="showSection('signup')">Sign Up Instead</button>
    </div>
  </section>

  <!-- Sign Up -->
  <section id="signup">
    <div class="signup-container">
      <h2>Sign Up</h2>
      <form id="signupForm">
        <input type="email" id="signupEmail" placeholder="surname_rollno@nitc.ac.in" required>
        <input type="password" id="signupPassword" placeholder="Password" required>
        <button type="submit" class="main-btn login-btn">Sign Up</button>
      </form>
      <button class="back-btn" onclick="showSection('login')">Back to Login</button>
    </div>
  </section>

  <!-- Role Selection -->
  <section id="role">
    <div class="container">
      <h2>Select your role</h2>
      <button class="main-btn student-btn" onclick="showSection('student')">Student</button>
      <button class="main-btn organizer-btn" onclick="showSection('organizer')">Organizer</button>
      <button class="back-btn" onclick="showSection('login')">Back</button>
    </div>
  </section>

  <!-- Student -->
  <section id="student">
    <div class="container">
      <h2>Student QR Generator</h2>
      <input type="text" id="rollNo" placeholder="Enter Roll Number">
      <select id="shirtSize">
        <option value="">Select T-shirt Size</option>
        <option value="S">S</option>
        <option value="M">M</option>
        <option value="L">L</option>
        <option value="XL">XL</option>
        <option value="XXL">XXL</option>
      </select>
      <button class="main-btn student-btn" onclick="generateQR()">Generate QR</button>
      <canvas id="qrCanvas"></canvas>
      <a id="downloadLink" class="download-link" download="student_qr.png">Download</a>
      <button class="back-btn" onclick="showSection('role')">Back</button>
    </div>
  </section>

  <!-- Organizer -->
  <section id="organizer">
    <div class="container">
      <h2>Organizer Dashboard</h2>
      <button id="pay-btn" class="main-btn organizer-btn">Pay to Access Organizer</button>
      <div id="organizer-panel" style="display:none">
        <button id="start-scan" class="main-btn organizer-btn">Start QR Scanner</button>
        <button id="stop-scan" style="display:none" class="main-btn organizer-btn">Stop Scanner</button>
        <div id="reader" class="scan-area">Scanner inactive</div>

        <h3>Allowed Roll Numbers</h3>
        <div id="allowed-list" class="list-box">No entries yet</div>
        <button id="clear-list" class="main-btn organizer-btn">Clear Allowed List</button>
      </div>
      <button class="back-btn" onclick="showSection('role')">Back</button>
    </div>
  </section>

  <!-- External Libs -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
  <script src="https://unpkg.com/html5-qrcode@2.3.7/minified/html5-qrcode.min.js"></script>

  <!-- App Logic -->
  <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

  const firebaseConfig = {
  apiKey: "AIzaSyAlXr6m9jLqRb5EUVxDXd6ZXeViYJYRH9A",
  authDomain: "festapp-367a1.firebaseapp.com",
  databaseURL: "https://festapp-367a1-default-rtdb.firebaseio.com",
  projectId: "festapp-367a1",
  storageBucket: "festapp-367a1.firebasestorage.app",
  messagingSenderId: "965286702395",
  appId: "1:965286702395:web:21ccdbd85f2ba874439b1e",
  measurementId: "G-N7B0W2KNSX"
};

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);
  const allowedCollection = collection(db, "allowed");

  // --- Section navigation ---
  function showSection(id){
    document.querySelectorAll('section').forEach(sec=>sec.classList.remove('active'));
    document.getElementById(id).classList.add('active');
  }
  window.showSection = showSection; // expose to HTML onclick

  // --- SIGNUP ---
  document.getElementById("signupForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const email=document.getElementById("signupEmail").value.trim();
    const password=document.getElementById("signupPassword").value.trim();
    try {
      await createUserWithEmailAndPassword(auth,email,password);
      alert("Account created!");
      showSection("login");
    } catch(err){ alert(err.message); }
  });

  // --- LOGIN ---
  document.getElementById("loginForm").addEventListener("submit", async (e)=>{
    e.preventDefault();
    const email=document.getElementById("loginEmail").value.trim();
    const password=document.getElementById("loginPassword").value.trim();
    try {
      await signInWithEmailAndPassword(auth,email,password);
      alert("Login successful!");
      showSection("role");
    } catch(err){
      document.getElementById("errorMsg").textContent=err.message;
    }
  });

  // --- Organizer list functions ---
  async function renderAllowed(){
    const snapshot=await getDocs(allowedCollection);
    const box=document.getElementById("allowed-list");
    box.innerHTML="";
    let i=1;
    snapshot.forEach(docSnap=>{
      const d=docSnap.data();
      box.innerHTML+=`${i++}. Roll: ${d.rollNo}, Size: ${d.shirtSize}<br>`;
    });
  }
  window.renderAllowed = renderAllowed;

  async function clearAllowed(){
    const snapshot=await getDocs(allowedCollection);
    for(const docSnap of snapshot.docs){
      await deleteDoc(doc(db,"allowed",docSnap.id));
    }
    renderAllowed();
  }
  document.getElementById("clear-list").addEventListener("click",()=>clearAllowed());

</script>

</body>
</html>



