<!DOCTYPE html>
<html lang="en">
<head>
Â  <meta charset="UTF-8">
Â  <title>Fest Entry - Firebase Flow</title>
Â  <style>
/* ----------------- AURORA FEST THEME ----------------- */
* {
Â  margin: 0;
Â  padding: 0;
Â  box-sizing: border-box;
Â  font-family: 'Poppins', sans-serif;
}

body {
Â  background: linear-gradient(135deg, #0f0c29, #302b63, #24243e);
Â  min-height: 100vh;
Â  display: flex;
Â  justify-content: center;
Â  align-items: center;
Â  color: #e0e0e0;
}

/* Containers */
.container, .login-container, .signup-container {
Â  background: rgba(15, 15, 25, 0.85);
Â  padding: 30px;
Â  border-radius: 18px;
Â  box-shadow: 0 0 25px rgba(0, 255, 200, 0.25), 0 0 40px rgba(255, 0, 128, 0.15);
Â  width: 360px;
Â  max-width: 90%;
Â  text-align: center;
Â  animation: fadeIn 0.6s ease-in-out;
Â  backdrop-filter: blur(6px);
}

h1, h2, h3 {
Â  margin-bottom: 20px;
Â  font-weight: 600;
Â  background: linear-gradient(90deg, #00ffcc, #ff3ec9);
Â  -webkit-background-clip: text;
Â  color: transparent;
Â  -webkit-text-fill-color: transparent;
}

input, select {
Â  padding: 8px 12px;
Â  font-size: 16px;
Â  margin: 8px 0;
Â  width: 100%;
Â  color: #000;
Â  background-color: #fff;
Â  border: 1px solid #ccc;
Â  border-radius: 5px;
}

button {
Â  width: 100%;
Â  padding: 12px;
Â  margin-top: 10px;
Â  background: linear-gradient(90deg, #00ffcc, #ff3ec9);
Â  color: #fff;
Â  border: none;
Â  border-radius: 12px;
Â  font-size: 16px;
Â  cursor: pointer;
Â  font-weight: 600;
}

button:hover {
Â  transform: translateY(-2px) scale(1.02);
Â  box-shadow: 0 0 15px rgba(0,255,200,0.4), 0 0 20px rgba(255,0,128,0.3);
}

.error {Â 
Â  color: #ff6b6b;Â 
Â  background: rgba(255,0,0,0.1);
Â  padding: 6px;
Â  border-radius: 8px;
Â  margin-top: 10px;
}

.list-box {
Â  max-height: 200px;
Â  overflow:auto;
Â  border:1px solid rgba(255,255,255,0.15);
Â  padding:10px;
Â  border-radius:12px;
Â  background: rgba(255,255,255,0.05);
Â  text-align:left;
Â  margin-bottom:10px;
Â  color: #ccc;
}

@keyframes fadeIn {
Â  0% { opacity:0; transform: translateY(-10px);}
Â  100% { opacity:1; transform: translateY(0);}
}

section { display: none; }
section.active { display: block; }
</style>
</head>
<body>
Â Â 
Â  Â  <section id="login" class="active">
Â  Â  <div class="login-container">
Â  Â  Â  <h2>Login</h2>
Â  Â  Â  <form id="loginForm">
Â  Â  Â  Â  <input type="email" id="loginEmail" placeholder="surname_rollno@nitc.ac.in" required>
Â  Â  Â  Â  <input type="password" id="loginPassword" placeholder="Password" required>
Â  Â  Â  Â  <button type="submit">Login</button>
Â  Â  Â  </form>
Â  Â  Â  <p id="errorMsg" class="error"></p>
Â  Â  Â  <button onclick="showSection('signup')">Sign Up Instead</button>
Â  Â  </div>
Â  </section>

Â  Â  <section id="signup">
Â  Â  <div class="signup-container">
Â  Â  Â  <h2>Sign Up</h2>
Â  Â  Â  <form id="signupForm">
Â  Â  Â  Â  <input type="email" id="signupEmail" placeholder="surname_rollno@nitc.ac.in" required>
Â  Â  Â  Â  <input type="password" id="signupPassword" placeholder="Password" required>
Â  Â  Â  Â  <button type="submit">Sign Up</button>
Â  Â  Â  </form>
Â  Â  Â  <p id="signupErrorMsg" class="error"></p>
Â  Â  Â  <button onclick="showSection('login')">Back to Login</button>
Â  Â  </div>
Â  </section>

Â  Â  <section id="role">
Â  Â  <div class="container">
Â  Â  Â  <h2>Select your role</h2>
Â  Â  Â  <button onclick="showSection('student')">Student</button>
Â  Â  Â  <button onclick="showSection('organizer')">Organizer</button>
Â  Â  Â  <button onclick="showSection('login')">Back</button>
Â  Â  </div>
Â  </section>

Â  Â  <section id="student">
Â  Â  <div class="container">
Â  Â  Â  <h2>Student QR Generator</h2>
Â  Â  Â  <input type="text" id="rollNo" placeholder="Enter Roll Number">
Â  Â  Â  <select id="shirtSize">
Â  Â  Â  Â  <option value="">Select T-shirt Size</option>
Â  Â  Â  Â  <option value="S">S</option>
Â  Â  Â  Â  <option value="M">M</option>
Â  Â  Â  Â  <option value="L">L</option>
Â  Â  Â  Â  <option value="XL">XL</option>
Â  Â  Â  Â  <option value="XXL">XXL</option>
Â  Â  Â  </select>
Â  Â  Â  <button onclick="generateQR()">Generate QR</button>
Â  Â  Â  <canvas id="qrCanvas"></canvas>
Â  Â  Â  <a id="downloadLink" class="download-link" download="student_qr.png" style="display:none;">Download</a>
Â  Â  Â  <button onclick="showSection('role')">Back</button>
Â  Â  </div>
Â  </section>

Â  Â  <section id="organizer">
Â  Â  <div class="container">
Â  Â  Â  <h2>Organizer Dashboard</h2>
Â  Â  Â  <button id="pay-btn">Pay to Access Organizer</button>
Â  Â  Â  <div id="organizer-panel" style="display:none">
Â  Â  Â  Â  <h3>Allowed Roll Numbers</h3>
Â  Â  Â  Â  <div id="allowed-list" class="list-box">No entries yet</div>
Â  Â  Â  Â  <button id="clear-list">Clear Allowed List</button>
Â  Â  Â  </div>
Â  Â  Â  <button onclick="showSection('role')">Back</button>
Â  Â  </div>
Â  </section>

Â  Â  <script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

Â  Â  <script type="module">
Â  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
Â  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
Â  import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

Â  // ðŸš¨ YOU MUST REPLACE ALL VALUES BELOW WITH YOUR ACTUAL FIREBASE CONFIGURATION ðŸš¨
Â  const firebaseConfig = {
  apiKey: "AIzaSyAlXr6m9jLqRb5EUVxDXd6ZXeViYJYRH9A",
  authDomain: "festapp-367a1.firebaseapp.com",
  databaseURL: "https://festapp-367a1-default-rtdb.firebaseio.com",
  projectId: "festapp-367a1",
  storageBucket: "festapp-367a1.firebasestorage.app",
  messagingSenderId: "965286702395",
  appId: "1:965286702395:web:21ccdbd85f2ba874439b1e",
  measurementId: "G-N7B0W2KNSX"
};

Â  const app = initializeApp(firebaseConfig);
Â  const auth = getAuth(app);
Â  const db = getFirestore(app);
Â  const allowedCollection = collection(db, "allowed");
Â  const loginError = document.getElementById("errorMsg");
Â  const signupError = document.getElementById("signupErrorMsg");

Â  // --- Section navigation ---
Â  function showSection(id){
Â  Â  document.querySelectorAll('section').forEach(sec=>sec.classList.remove('active'));
Â  Â  document.getElementById(id).classList.add('active');
Â  Â  // Clear login/signup errors when switching sections
Â  Â  loginError.textContent = "";
Â  Â  signupError.textContent = "";
Â  }
Â  window.showSection = showSection;

Â  // --- SIGNUP ---
Â  document.getElementById("signupForm").addEventListener("submit", async (e)=>{
Â  Â  e.preventDefault();
Â  Â  const email=document.getElementById("signupEmail").value.trim();
Â  Â  const password=document.getElementById("signupPassword").value.trim();

Â  Â  if (!email || !password) {
Â  Â  Â  signupError.textContent = "Email and Password are required.";
Â  Â  Â  return;
Â  Â  }
Â  Â  signupError.textContent = ""; // Clear previous error

Â  Â  try {
Â  Â  Â  await createUserWithEmailAndPassword(auth,email,password);
Â  Â  Â  alert("Account created! Please login.");
Â  Â  Â  showSection("login");
Â  Â  } catch(err){
Â  Â  Â  signupError.textContent = err.message; 
Â  Â  }
Â  });

Â  // --- LOGIN ---
Â  document.getElementById("loginForm").addEventListener("submit", async (e)=>{
Â  Â  e.preventDefault();
Â  Â  const email=document.getElementById("loginEmail").value.trim();
Â  Â  const password=document.getElementById("loginPassword").value.trim();

Â  Â  if (!email || !password) {
Â  Â  Â  loginError.textContent = "Email and Password are required.";
Â  Â  Â  return;
Â  Â  }
Â  Â  loginError.textContent = ""; // Clear previous error

Â  Â  try {
Â  Â  Â  await signInWithEmailAndPassword(auth,email,password);
Â  Â  Â  alert("Login successful!");
Â  Â  Â  showSection("role");
Â  Â  } catch(err){
Â  Â  Â  loginError.textContent = err.message;
Â  Â  }
Â  });

Â  // --- Student QR Generator ---
Â  function generateQR(){
Â  Â  let rollNo=document.getElementById("rollNo").value.trim().toUpperCase();
Â  Â  const shirtSize=document.getElementById("shirtSize").value;
Â  Â  const rollRegex=/^[A-Z0-9]{5,}$/;

Â  Â  if(!rollRegex.test(rollNo)){ alert("Enter a proper roll number (min 5 alphanumeric characters)!"); return; }
Â  Â  if(!shirtSize){ alert("Select T-shirt size!"); return; }

Â  Â  const qrData=`RollNo=${rollNo};Size=${shirtSize}`;
Â  Â  const canvas=document.getElementById("qrCanvas");
Â  Â  
Â  Â  // Save to Firestore *before* generating QR (ensures entry is logged)
Â  Â  addDoc(allowedCollection, { rollNo, shirtSize, timestamp: Date.now() })
Â  Â  Â  .then(() => console.log("Student data logged to Firestore."))
Â  Â  Â  .catch(error => console.error("Error logging student data: ", error));

Â  Â  QRCode.toCanvas(canvas, qrData,{width:200},function(err){
Â  Â  Â  if(err) console.error(err);
Â  Â  Â  else{
Â  Â  Â  Â  const downloadLink=document.getElementById("downloadLink");
Â  Â  Â  Â  downloadLink.style.display="inline-block";
Â  Â  Â  Â  downloadLink.href=canvas.toDataURL("image/png");
Â  Â  Â  Â  alert("QR Code Generated! Don't forget to download it.");
Â  Â  Â  }
Â  Â  });
Â  }
Â  window.generateQR = generateQR;

Â  // --- Organizer Panel ---
Â  async function renderAllowed(){
Â  Â  const snapshot=await getDocs(allowedCollection);
Â  Â  const box=document.getElementById("allowed-list");
Â  Â  if(snapshot.empty){ box.innerHTML="No entries yet"; return; }
Â  Â  box.innerHTML="";
Â  Â  let i=1;
Â  Â  snapshot.forEach(docSnap=>{
Â  Â  Â  const d=docSnap.data();
Â  Â  Â  box.innerHTML+=`<span>${i++}. Roll: ${d.rollNo}, Size: ${d.shirtSize}</span><br>`;
Â  Â  });
Â  }
Â  window.renderAllowed = renderAllowed;

Â  async function clearAllowed(){
Â  Â  if (!confirm("Are you sure you want to clear ALL allowed roll numbers? This action is permanent!")) {
Â  Â  Â  return;
Â  Â  }
Â  Â  
Â  Â  const snapshot=await getDocs(allowedCollection);
Â  Â  let deletePromises = [];
Â  Â  snapshot.docs.forEach(docSnap => {
Â  Â  Â  deletePromises.push(deleteDoc(doc(db,"allowed",docSnap.id)));
Â  Â  });

Â  Â  try {
Â  Â  Â  await Promise.all(deletePromises);
Â  Â  Â  alert("All entries cleared successfully!");
Â  Â  Â  renderAllowed();
Â  Â  } catch (error) {
Â  Â  Â  console.error("Error clearing documents: ", error);
Â  Â  Â  alert("Error clearing entries. Check console for details.");
Â  Â  }
Â  }
Â  document.getElementById("clear-list").addEventListener("click",()=>clearAllowed());

Â  // Pay to unlock organizer
Â  document.getElementById("pay-btn").addEventListener("click",()=>{
Â  Â  alert("Payment successful! Access granted.");
Â  Â  document.getElementById("pay-btn").style.display="none";
Â  Â  document.getElementById("organizer-panel").style.display="block";
Â  Â  renderAllowed();
Â  });
</script>

</body>
</html>

